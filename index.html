<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch Ad and Claim Reward</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 50px; background: #f5f5f5; }
  #adContainer { width: 300px; height: 250px; margin: 20px auto; border: 1px solid #ccc; }
  button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin-top: 10px; }
  #claimBtn { display: none; background-color: #4CAF50; color: white; border: none; }
</style>
</head>
<body>

<h2>Watch Ad to Claim Reward</h2>
<button id="watchAdBtn">Watch Ad</button>

<div id="adContainer">Ad will appear here...</div>

<button id="claimBtn">Claim Reward</button>

<!-- Gigapub script -->
<script src="https://ad.gigapub.tech/script?id=1872" onload="initAd()"></script>

<script>
let adWatched = false;
let rewardTimer;

function initAd() {
    const watchBtn = document.getElementById('watchAdBtn');
    const claimBtn = document.getElementById('claimBtn');
    const adContainer = document.getElementById('adContainer');

    // Click to watch ad
    watchBtn.addEventListener('click', () => {
        watchBtn.disabled = true;
        adContainer.innerHTML = ''; // Clear previous content

        try {
            const ad = new GigaPubAd({
                container: 'adContainer',
                onAdStart: () => {
                    console.log("Ad started");
                    // 15-second timer before enabling reward
                    rewardTimer = setTimeout(() => {
                        adWatched = true;
                        claimBtn.style.display = 'inline-block';
                    }, 15000);
                },
                onAdError: (err) => {
                    console.error("Error processing ad:", err);
                    adContainer.innerHTML = "Failed to load ad. Please try again later.";
                    watchBtn.disabled = false;
                },
                onAdComplete: () => {
                    console.log("Ad completed");
                }
            });
            ad.load();
        } catch(e) {
            console.error("Ad initialization failed:", e);
            adContainer.innerHTML = "Ad cannot be loaded at this time.";
            watchBtn.disabled = false;
        }
    });

    // Prevent leaving page if ad not watched
    window.addEventListener('beforeunload', function (e) {
        if (!adWatched) {
            e.preventDefault();
            e.returnValue = 'You must watch the ad completely before leaving!';
        }
    });

    // Claim reward
    claimBtn.addEventListener('click', async () => {
        if (!adWatched) {
            alert("Wait at least 15 seconds before claiming reward.");
            return;
        }

        try {
            // Replace with your reward API
            const response = await fetch('/api/reward', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: 'USER_ID' })
            });

            const result = await response.json();
            if (result.success) {
                alert("Reward added successfully!");
                claimBtn.disabled = true;
            } else {
                alert("Failed to reward: " + result.message);
            }
        } catch (err) {
            console.error(err);
            alert("Error claiming reward.");
        }
    });
}
</script>

</body>
</html>
