<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ad Watch Reward</title>
<script src="https://ad.gigapub.tech/script?id=1872"></script>
<style>
body { font-family: Arial,sans-serif; background:#f9f9f9; text-align:center; padding:20px; }
#adContainer { position: relative; width: 320px; height: 250px; margin:auto; border:2px solid #ccc; border-radius:10px; overflow:hidden; background:#fff; }
#overlay { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); color:#fff; font-size:22px; display:flex; justify-content:center; align-items:center; flex-direction:column; }
#progress { width:80%; height:10px; background:#333; border-radius:5px; margin-top:10px; overflow:hidden; }
#bar { height:100%; width:0%; background:limegreen; transition: width 1s linear; }
#messageSection { margin-top:20px; display:none; font-size:18px; color:green; }
button { padding:10px 20px; border:none; border-radius:8px; cursor:pointer; background:dodgerblue; color:white; font-size:16px; }
button:disabled { background:gray; cursor:not-allowed; }
</style>
</head>
<body>

<h2>üéÅ Watch Ad to Get Reward</h2>

<div id="adContainer">
  <div id="gigapub-ad"></div>
  <div id="overlay">
    <div>‚è≥ Please watch the ad fully</div>
    <div id="progress"><div id="bar"></div></div>
  </div>
</div>

<div id="messageSection">‚úÖ Ad completed! Reward granted.</div>

<script>
let adCompleted = false;
let adStartTime = Date.now();

// Warn on leaving mid-ad
window.onbeforeunload = () => {
  if (!adCompleted) return "‚ùå You haven't completed the ad yet. Leaving will forfeit your reward!";
};

// Progress bar
function startProgress(duration = 15){
  const overlay = document.getElementById("overlay");
  const bar = document.getElementById("bar");
  let elapsed = 0;
  const timer = setInterval(()=>{
    elapsed++;
    bar.style.width = (elapsed/duration*100) + "%";
    if(elapsed>=duration || adCompleted){
      clearInterval(timer);
      overlay.style.display="none";
    }
  },1000);
}

window.onload = ()=>{
  // Check sessionStorage for incomplete ad
  const storedCompleted = sessionStorage.getItem('adCompleted');
  if(storedCompleted==='true'){
    adCompleted=true;
    document.getElementById("messageSection").style.display="block";
    document.getElementById("overlay").style.display="none";
    return; // already done
  } else if(sessionStorage.getItem('adStartTime')){
    alert(JSON.stringify({
      success:false,
      message:"‚ùå You must watch the ad fully before claiming reward."
    }));
  }

  adStartTime = Date.now();
  sessionStorage.setItem('adStartTime', adStartTime);

  startProgress(15);

  if(typeof window.showGiga==="function"){
    window.showGiga("gigapub-ad",{
      onComplete: ()=>{
        adCompleted=true;
        sessionStorage.setItem('adCompleted','true');
        document.getElementById("messageSection").style.display="block";
      },
      onError:()=>{
        alert("‚ùå Ad failed to load or complete. Reward cannot be granted.");
      }
    });
  }else{
    console.error("GigaPub ad SDK not loaded properly.");
  }
};
</script>

</body>
</html>
