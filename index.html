<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nai - Free Fire Topup</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <!-- Google Fonts - Poppins & Noto Sans Bengali -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>

  <style>
    :root {
      --primary: #FF9F1C;
      --primary-dark: #E88C0C;
      --primary-light: #FFF5E8;
      --secondary: #3AB0B4;
      --dark: #2B2D42;
      --light: #F8F9FA;
      --success: #198754;
      --danger: #DC3545;
      --warning: #FFC107;
      --info: #0DCAF0;
      --gray: #6C757D;
      --gray-light: #E9ECEF;
      --gradient-primary: linear-gradient(135deg, #FF9F1C, #FFBF69);
      --gradient-secondary: linear-gradient(135deg, #3AB0B4, #00D2FF);
    }
    
    body {
      background: #f5f8fb;
      font-family: 'Poppins', 'Noto Sans Bengali', sans-serif;
      color: var(--dark);
      min-height: 100vh;
      padding-bottom: 70px;
    }
    
    /* Typography */
    .text-bengali {
      font-family: 'Noto Sans Bengali', sans-serif;
    }
    
    /* Brand & Logo */
    .brand {
      color: var(--primary);
      font-weight: 700;
      font-size: 28px;
      letter-spacing: .6px;
      font-family: 'Poppins', sans-serif;
      display: flex;
      align-items: center;
    }
    
    .brand-logo {
      width: 36px;
      height: 36px;
      margin-right: 10px;
      background: var(--gradient-primary);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }
    
    /* Cards */
    .card {
      border-radius: 12px;
      border: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
      background: #fff;
      overflow: hidden;
    }
    
    .card-package {
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid #e6e9ee;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 1rem;
      background: #fff;
      border-radius: 10px;
      position: relative;
      overflow: hidden;
    }
    
    .card-package:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(248,154,28,0.15);
    }
    
    .card-package.selected {
      border: 2px solid var(--primary);
      box-shadow: 0 8px 20px rgba(248,154,28,0.2);
      transform: translateY(-3px);
    }
    
    .card-package.selected::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 0;
      height: 0;
      border-style: solid;
      border-width: 0 40px 40px 0;
      border-color: transparent var(--primary) transparent transparent;
    }
    
    .card-package.selected::before {
      content: '\f00c';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      position: absolute;
      top: 4px;
      right: 8px;
      color: white;
      font-size: 12px;
      z-index: 1;
    }
    
    .card-package.popular::before {
      content: 'Popular';
      position: absolute;
      top: 10px;
      left: -25px;
      width: 100px;
      padding: 2px 0;
      background: var(--primary);
      color: white;
      font-size: 10px;
      text-align: center;
      transform: rotate(-45deg);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Icons */
    .diamond-icon {
      color: var(--primary);
      font-size: 1.2rem;
      margin-right: 5px;
    }
    
    /* Price */
    .price {
      font-weight: 700;
      color: var(--primary);
      font-size: 1.1rem;
    }
    
    /* Section Titles */
    .section-title {
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--dark);
      position: relative;
      padding-left: 12px;
    }
    
    .section-title::before {
      content: '';
      position: absolute;
      left: 0;
      top: 5px;
      height: 18px;
      width: 4px;
      background: var(--primary);
      border-radius: 2px;
    }
    
    /* Rules & Conditions */
    .rules {
      background: #fff;
      border-radius: 10px;
      padding: 1.25rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .rules p {
      margin-bottom: 0.75rem;
      position: relative;
      padding-left: 24px;
    }
    
    .rules p::before {
      content: '\f111';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      position: absolute;
      left: 0;
      top: 4px;
      font-size: 8px;
      color: var(--primary);
    }
    
    /* Navigation */
    .bottom-nav {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: #fff;
      border-top: 1px solid #e6e9ee;
      padding: .75rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
      z-index: 1000;
    }
    
    .bottom-nav a {
      color: #666;
      text-decoration: none;
      text-align: center;
      flex: 1;
      transition: all 0.2s ease;
    }
    
    .bottom-nav a.active {
      color: var(--primary);
      transform: translateY(-2px);
    }
    
    .bottom-nav i {
      font-size: 1.2rem;
      display: block;
      margin-bottom: 4px;
    }
    
    .bottom-nav span {
      font-size: 11px;
      display: block;
    }
    
    /* Desktop Navigation */
    .desktop-nav {
      display: none;
      margin-left: auto;
    }
    
    .desktop-nav .nav-item {
      position: relative;
      margin-left: 10px;
    }
    
    .desktop-nav .nav-link {
      color: var(--dark);
      font-weight: 500;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    
    .desktop-nav .nav-link:hover, 
    .desktop-nav .nav-link.active {
      color: var(--primary);
      background: rgba(255, 159, 28, 0.1);
    }
    
    .desktop-nav .nav-link i {
      margin-right: 6px;
    }
    
    /* Wallet Balance */
    .wallet-balance {
      font-size: .95rem;
      color: var(--success);
      background: rgba(25, 135, 84, 0.1);
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 500;
      display: flex;
      align-items: center;
      transition: all 0.2s ease;
    }
    
    .wallet-balance:hover {
      background: rgba(25, 135, 84, 0.2);
    }
    
    .wallet-balance i {
      margin-right: 5px;
    }
    
    /* Modals */
    .modal-order .modal-header {
      background: var(--gradient-primary);
      color: #fff;
      border-radius: 12px 12px 0 0 !important;
    }
    
    .modal-order .modal-content {
      border-radius: 12px !important;
      overflow: hidden;
    }
    
    /* Payment Options */
    .payment-option {
      cursor: pointer;
      border-radius: 10px;
      padding: 1rem;
      transition: all 0.2s ease;
      border: 1px solid #e6e9ee;
    }
    
    .payment-option:hover {
      border-color: var(--primary);
    }
    
    .payment-option.selected {
      border: 2px solid var(--primary);
      background-color: rgba(248, 154, 28, 0.05);
    }
    
    .payment-option .icon {
      width: 40px;
      height: 40px;
      background: rgba(248, 154, 28, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      color: var(--primary);
    }
    
    /* Game Icon */
    .game-icon {
      width: 64px;
      height: 64px;
      border-radius: 12px;
      object-fit: cover;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    /* Buttons */
    .btn-primary {
      background-color: var(--primary);
      border-color: var(--primary);
      font-weight: 500;
    }
    
    .btn-primary:hover {
      background-color: var(--primary-dark);
      border-color: var(--primary-dark);
    }
    
    .btn-success {
      padding: 10px 24px;
      border-radius: 8px;
      font-weight: 600;
    }
    
    .btn-gradient {
      background: var(--gradient-primary);
      color: white;
      border: none;
      font-weight: 500;
    }
    
    .btn-gradient:hover {
      background: linear-gradient(135deg, #E88C0C, #FF9F1C);
      color: white;
    }
    
    /* Form Elements */
    .form-control {
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid #e6e9ee;
    }
    
    .form-control:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 0.25rem rgba(248, 154, 28, 0.25);
    }
    
    /* Nav tabs */
    .nav-tabs {
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    
    .nav-tabs .nav-link {
      color: var(--gray);
      font-weight: 500;
      border: none;
      padding: 12px 16px;
      position: relative;
    }
    
    .nav-tabs .nav-link.active {
      color: var(--primary);
      background: transparent;
      border: none;
    }
    
    .nav-tabs .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--primary);
      border-radius: 3px 3px 0 0;
    }
    
    /* Wallet section */
    .wallet-card {
      background: var(--gradient-secondary);
      color: white;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }
    
    .wallet-card::before {
      content: '';
      position: absolute;
      top: -50px;
      right: -50px;
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
    }
    
    .wallet-card::after {
      content: '';
      position: absolute;
      bottom: -80px;
      right: -30px;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: rgba(255,255,255,0.05);
    }
    
    .wallet-amount {
      font-size: 2.5rem;
      font-weight: 700;
      line-height: 1;
    }
    
    .wallet-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 20px;
    }
    
    .wallet-action-btn {
      background: rgba(255,255,255,0.15);
      border: none;
      color: white;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      transition: all 0.2s ease;
    }
    
    .wallet-action-btn:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-2px);
    }
    
    .wallet-action-btn i {
      display: block;
      font-size: 1.5rem;
      margin-bottom: 5px;
    }
    
    /* Transactions */
    .transaction-item {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .transaction-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      color: white;
      flex-shrink: 0;
    }
    
    .transaction-icon.income {
      background: var(--success);
    }
    
    .transaction-icon.expense {
      background: var(--danger);
    }
    
    .transaction-details {
      flex-grow: 1;
    }
    
    .transaction-amount {
      font-weight: 600;
    }
    
    .transaction-amount.income {
      color: var(--success);
    }
    
    .transaction-amount.expense {
      color: var(--danger);
    }
    
    /* Orders */
    .order-card {
      border-left: 4px solid var(--primary);
      transition: all 0.2s ease;
    }
    
    .order-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .order-status {
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 12px;
      font-weight: 500;
    }
    
    .order-status.completed {
      background: rgba(25, 135, 84, 0.1);
      color: var(--success);
    }
    
    .order-status.pending {
      background: rgba(255, 193, 7, 0.1);
      color: var(--warning);
    }
    
    .order-status.failed {
      background: rgba(220, 53, 69, 0.1);
      color: var(--danger);
    }
    
    /* Profile */
    .profile-header {
      position: relative;
      height: 120px;
      background: var(--gradient-primary);
      border-radius: 12px 12px 0 0;
      overflow: hidden;
    }
    
    .profile-avatar {
      width: 100px;
      height: 100px;
      border-radius: 20px;
      border: 3px solid white;
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      overflow: hidden;
    }
    
    .profile-body {
      padding-top: 50px;
    }
    
    .profile-stat {
      text-align: center;
      padding: 15px 0;
    }
    
    .profile-stat-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--dark);
    }
    
    .profile-stat-label {
      font-size: 0.8rem;
      color: var(--gray);
    }
    
    .profile-menu-item {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--gray-light);
      color: var(--dark);
      text-decoration: none;
      transition: all 0.2s ease;
    }
    
    .profile-menu-item:hover {
      color: var(--primary);
    }
    
    .profile-menu-item i {
      width: 24px;
      text-align: center;
      margin-right: 10px;
      color: var(--primary);
    }
    
    /* Badges */
    .badge-primary {
      background: rgba(255, 159, 28, 0.1);
      color: var(--primary);
    }
    
    /* Responsive tweaks */
    @media (min-width: 992px) {
      .bottom-nav {
        display: none;
      }
      
      .desktop-nav {
        display: flex;
      }
      
      .wallet-balance {
        margin-left: 15px;
      }
      
      .packages-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
      }
    }
    
    @media (min-width: 768px) and (max-width: 991px) {
      .packages-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
    }
    
    @media (max-width: 767px) {
      .packages-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.8rem;
      }
      
      .brand {
        font-size: 22px;
      }
      
      .game-icon {
        width: 50px;
        height: 50px;
      }
      
      .wallet-amount {
        font-size: 2rem;
      }
    }
    
    /* Animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.4s ease forwards;
    }
    
    /* Success animation */
    .checkmark {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: block;
      stroke-width: 4;
      stroke: var(--success);
      stroke-miterlimit: 10;
      margin: 0 auto 20px;
      box-shadow: 0 0 0 rgba(25, 135, 84, 0.4);
      animation: checkmark-fill 0.4s ease-in-out 0.4s forwards, checkmark-scale 0.3s ease-in-out 0.9s both;
    }
    
    .checkmark-circle {
      stroke-dasharray: 166;
      stroke-dashoffset: 166;
      stroke-width: 4;
      stroke-miterlimit: 10;
      stroke: var(--success);
      fill: none;
      animation: checkmark-stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
    }
    
    .checkmark-check {
      transform-origin: 50% 50%;
      stroke-dasharray: 48;
      stroke-dashoffset: 48;
      animation: checkmark-stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
    }
    
    @keyframes checkmark-stroke {
      100% { stroke-dashoffset: 0; }
    }
    
    @keyframes checkmark-scale {
      0%, 100% { transform: none; }
      50% { transform: scale3d(1.1, 1.1, 1); }
    }
    
    @keyframes checkmark-fill {
      100% { box-shadow: inset 0 0 0 100px rgba(25, 135, 84, 0.1); }
    }
    
    /* Page transitions */
    .page {
      display: none;
    }
    
    .page.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    /* Shake animation for errors */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }
    
    .shake {
      animation: shake 0.5s ease;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }
    
    /* Loading spinner */
    .spinner-border {
      width: 1.5rem;
      height: 1.5rem;
      border-width: 0.2em;
    }
    
    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 2rem;
      color: var(--gray);
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--gray-light);
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm py-3 rounded-bottom-4">
  <div class="container">
    <a href="#" class="brand text-decoration-none">
      <div class="brand-logo">
        <i class="fa-solid fa-shield-halved"></i>
      </div>
      <span>Top-up NAI</span>
    </a>
    
    <!-- Desktop Navigation -->
    <ul class="desktop-nav navbar-nav">
      <li class="nav-item">
        <a href="#" class="nav-link active" data-page="homePage">
          <i class="fa-solid fa-home"></i> Home
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" data-page="walletPage">
          <i class="fa-solid fa-wallet"></i> Wallet
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" data-page="ordersPage">
          <i class="fa-solid fa-gamepad"></i> Orders
        </a>
      </li>
    </ul>
    
    <div class="d-flex align-items-center gap-3">
      <div class="wallet-balance d-none d-lg-flex" data-page="walletPage">
        <i class="fa-solid fa-wallet"></i>
        <span class="fw-bold" id="walletBalanceText">৳0.00</span>
      </div>
      <div class="dropdown">
        <a href="#" class="dropdown-toggle" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <img src="https://i.pravatar.cc/40?img=5" class="rounded-circle shadow-sm" alt="user" id="userAvatar">
        </a>
        <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="profileDropdown">
          <li><a class="dropdown-item" href="#" data-page="profilePage"><i class="fa-solid fa-user me-2"></i>Profile</a></li>          
          <li><a class="dropdown-item" href="#"><i class="fa-solid fa-gear me-2"></i>Settings</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger" href="#" id="logoutBtn"><i class="fa-solid fa-right-from-bracket me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>
<br>
<main class="container mb-5 pb-5">
  <!-- Home Page (Topup) -->
  <div class="page active" id="homePage">
    <div class="row">
      <div class="col-lg-9 mx-auto">

        <!-- Product header -->
        <div class="card mb-4 fade-in">
          <div class="card-body d-flex gap-4 align-items-center">
            <img src="logo.jpeg" alt="Free Fire" class="game-icon">
            <div>
              <h5 class="mb-0">Free Fire Topup (BD Server)</h5>
              <small class="text-muted">Game / Diamond Topup</small>
            </div>
          </div>
        </div>

        <!-- 1. Select Recharge -->
        <div class="mb-4 fade-in" style="animation-delay: 0.1s">
          <h6 class="section-title">1. Select Diamond Package</h6>
          <div class="packages-grid mb-3" id="packagesContainer">
            <!-- JS will populate packages here -->
          </div>
        </div>

        <!-- 2. Account Info -->
        <div class="mb-4 fade-in" style="animation-delay: 0.2s">
          <h6 class="section-title">2. Account Information</h6>
          <div class="card p-3">
            <label for="accountInput" class="form-label mb-2 fw-500">Player ID / Account Code</label>
            <input id="accountInput" type="text" class="form-control" placeholder="Enter Free Fire ID (BD server)">
            <div class="form-text text-danger mt-1" id="accountError" style="display:none;">
              <i class="fa-solid fa-circle-exclamation me-1"></i> Player ID is required.
            </div>
          </div>
        </div>

        <!-- 3. Payment Option -->
        <div class="mb-4 fade-in" style="animation-delay: 0.3s">
          <h6 class="section-title">3. Payment Method</h6>
          <div class="d-flex gap-3 mb-3">
            <div class="payment-option flex-fill" id="walletPay">
              <div class="icon mb-2">
                <i class="fa-solid fa-wallet"></i>
              </div>
              <div class="fw-500">Wallet Pay</div>
              <small class="text-muted">Use your wallet balance</small>
            </div>
            <div class="payment-option flex-fill selected" id="instantPay">
              <div class="icon mb-2">
                <i class="fa-solid fa-bolt"></i>
              </div>
              <div class="fw-500">Instant Pay</div>
              <small class="text-muted">bKash / Nagad / Rocket</small>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center p-3 rounded-4 shadow-sm" 
     style="background: rgba(255,255,255,0.75); backdrop-filter: blur(10px);">
            <div>
              <div class="text-muted small">Total Amount</div>
              <div id="selectedPriceText" class="fw-bold fs-5">৳24</div>
            </div>
            <button id="buyNowBtn" class="btn btn-success px-4">
              <i class="fa-solid fa-bag-shopping me-2"></i>Buy Now
            </button>
          </div>
        </div>

        <!-- Rules & Conditions -->
        <div class="mb-5 fade-in" style="animation-delay: 0.4s">
          <h6 class="section-title">Rules & Conditions</h6>
          <div class="rules">
            <p class="text-bengali">শুধুমাত্র Bangladesh সার্ভারে ID Code দিয়ে টপ আপ হবে।</p>
            <p class="text-bengali">Player ID ভুল দিয়ে Diamond না পেলে nai কর্তৃপক্ষ দায়ী নয়।</p>
            <p class="text-bengali">Order কমপ্লিট হবার পরে আইডিতে ডাইমন্ড না গেলে চেক করার জন্য ID Pass, backup code দিতে হবে।</p>
            <p class="text-bengali">ডাইমন্ড ট্রান্সফার হতে সাধারণত ৫-৩০ মিনিট সময় লাগতে পারে।</p>
            <p class="text-bengali">কোন সমস্যা হলে আমাদের লাইভ চ্যাটে যোগাযোগ করুন।</p>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Wallet Page -->
  <div class="page" id="walletPage">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="mb-4">
          <h5 class="fw-bold mb-3">My Wallet</h5>
          
          <div class="wallet-card p-4 mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div>
                <div class="text-white-50 small">Current Balance</div>
                <div class="wallet-amount text-white" id="walletBalanceBigText">৳0.00</div>
              </div>
              
            </div>
            
            <div class="wallet-actions">
              <button class="wallet-action-btn" data-bs-toggle="modal" data-bs-target="#addMoneyModal">
                <i class="fa-solid fa-money-bill-transfer"></i>
                <span>Add Money</span>
              </button>
              <button class="wallet-action-btn" data-bs-toggle="modal" data-bs-target="#withdrawModal">
                <i class="fa-solid fa-hand-holding-dollar"></i>
                <span>Withdraw</span>
              </button>
            </div>
          </div>
          
          <div class="card mb-4">
            <div class="card-body">
              <h6 class="section-title mb-3">Recent Transactions</h6>
              
              <div id="transactionsContainer">
                <!-- Transactions will be loaded here -->
                <div class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
              
              <a href="#" class="btn btn-outline-primary w-100 mt-3" id="viewAllTransactionsBtn">View All Transactions</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Orders Page -->
  <div class="page" id="ordersPage">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="mb-4">
          <h5 class="fw-bold mb-3">My Orders</h5>
          
          <ul class="nav nav-tabs mb-4" id="ordersTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab">All</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button" role="tab">Completed</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab">Pending</button>
            </li>
          </ul>
          
          <div class="tab-content" id="ordersTabContent">
            <div class="tab-pane fade show active" id="all" role="tabpanel">
              <div id="allOrdersContainer">
                <!-- All orders will be loaded here -->
                <div class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
              
              <a href="#" class="btn btn-outline-primary w-100" id="viewAllOrdersBtn">View All Orders</a>
            </div>
            
            <div class="tab-pane fade" id="completed" role="tabpanel">
              <div id="completedOrdersContainer">
                <!-- Completed orders will be loaded here -->
                <div class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
              
              <a href="#" class="btn btn-outline-primary w-100">View All Completed Orders</a>
            </div>
            
            <div class="tab-pane fade" id="pending" role="tabpanel">
              <div id="pendingOrdersContainer">
                <!-- Pending orders will be loaded here -->
                <div class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
              
              <a href="#" class="btn btn-outline-primary w-100">View All Pending Orders</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Page -->
  <div class="page" id="profilePage">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="mb-4">
          <div class="card">
            <div class="profile-header"></div>
            <div class="profile-avatar">
              <img src="https://i.pravatar.cc/150?img=5" class="img-fluid" alt="Profile" id="profileAvatar">
            </div>
            <div class="card-body profile-body text-center">
              <h5 class="mb-1" id="profileName">Loading...</h5>
              <p class="text-muted small mb-3" id="memberSince">Member since ...</p>
              
              <div class="d-flex justify-content-around border-top border-bottom py-3 mb-4">
                <div class="profile-stat">
                  <div class="profile-stat-value" id="totalOrders">0</div>
                  <div class="profile-stat-label">Orders</div>
                </div>
                <div class="profile-stat">
                  <div class="profile-stat-value" id="totalSpent">৳0</div>
                  <div class="profile-stat-label">Spent</div>
                </div>
                <div class="profile-stat">
                  <div class="profile-stat-value" id="totalReferrals">0</div>
                  <div class="profile-stat-label">Referrals</div>
                </div>
              </div>
              
              <div class="mb-4">
                <h6 class="section-title text-start mb-3">Account Settings</h6>
                
                <a href="#" class="profile-menu-item">
                  <i class="fa-solid fa-user"></i>
                  <span>Personal Information</span>
                  <i class="fa-solid fa-chevron-right ms-auto"></i>
                </a>
                
                <a href="#" class="profile-menu-item">
                  <i class="fa-solid fa-lock"></i>
                  <span>Change Password</span>
                  <i class="fa-solid fa-chevron-right ms-auto"></i>
                </a>
                
                <a href="#" class="profile-menu-item">
                  <i class="fa-solid fa-wallet"></i>
                  <span>Payment Methods</span>
                  <i class="fa-solid fa-chevron-right ms-auto"></i>
                </a>
                
                <a href="#" class="profile-menu-item">
                  <i class="fa-solid fa-bell"></i>
                  <span>Notification Settings</span>
                  <i class="fa-solid fa-chevron-right ms-auto"></i>
                </a>
              </div>
              
              <div class="mb-3">
                <h6 class="section-title text-start mb-3">Support</h6>
                
                <a href="#" class="profile-menu-item">
                  <i class="fa-solid fa-headset"></i>
                  <span>Help Center</span>
                  <i class="fa-solid fa-chevron-right ms-auto"></i>
                </a>
                
                <a href="#" class="profile-menu-item">
                  <i class="fa-solid fa-circle-info"></i>
                  <span>About Nai</span>
                  <i class="fa-solid fa-chevron-right ms-auto"></i>
                </a>
                
                <a href="#" class="profile-menu-item">
                  <i class="fa-solid fa-share-nodes"></i>
                  <span>Invite Friends</span>
                  <i class="fa-solid fa-chevron-right ms-auto"></i>
                </a>
              </div>
              
              <button class="btn btn-outline-danger w-100 mt-2" id="logoutBtnBottom">
                <i class="fa-solid fa-right-from-bracket me-2"></i>Logout
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Fixed bottom nav (mobile only) -->
<div class="bottom-nav d-lg-none">
  <a href="#" class="active" data-page="homePage">
    <i class="fa-solid fa-home"></i>
    <span>Home</span>
  </a>
  <a href="#" data-page="walletPage">
    <i class="fa-solid fa-wallet"></i>
    <span>Wallet</span>
  </a>
  <a href="#" data-page="ordersPage">
    <i class="fa-solid fa-gamepad"></i>
    <span>Orders</span>
  </a>
  <a href="#" data-page="profilePage">
    <i class="fa-solid fa-user"></i>
    <span>Profile</span>
  </a>
</div>

<!-- Order Summary Modal -->
<div class="modal fade modal-order" id="orderModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fa-solid fa-cart-shopping me-2"></i>Order Summary</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="orderSummary">
          <!-- populated by JS -->
        </div>
        <div class="mt-4">
          <label for="note" class="form-label">Additional Information (Optional)</label>
          <textarea id="note" class="form-control" placeholder="If you want to provide backup code or ID password..." rows="3"></textarea>
          <div class="form-text">For security verification if diamonds not delivered</div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button id="confirmOrderBtn" class="btn btn-gradient">
          <i class="fa-solid fa-lock me-2"></i>Confirm Payment
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Add Money Modal -->
<div class="modal fade" id="addMoneyModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fa-solid fa-money-bill-transfer me-2"></i>Add Money</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="amount" class="form-label">Amount (BDT)</label>
          <input type="number" class="form-control" id="amount" placeholder="Enter amount">
          <div class="form-text text-danger" id="amountError" style="display: none;"></div>
        </div>
        
        <div class="mb-3">
          <label class="form-label">Payment Method</label>
          <div class="d-flex gap-3">
            <div class="payment-option flex-fill selected" data-method="bkash">
              <div class="icon mb-2">
                <i class="fa-solid fa-mobile-screen"></i>
              </div>
              <div class="fw-500">bKash</div>
            </div>
            <div class="payment-option flex-fill" data-method="nagad">
              <div class="icon mb-2">
                <i class="fa-solid fa-money-bill-wave"></i>
              </div>
              <div class="fw-500">Nagad</div>
            </div>
            <div class="payment-option flex-fill" data-method="rocket">
              <div class="icon mb-2">
                <i class="fa-solid fa-rocket"></i>
              </div>
              <div class="fw-500">Rocket</div>
            </div>
          </div>
        </div>
        
        <div class="alert alert-info">
          <i class="fa-solid fa-circle-info me-2"></i> Minimum deposit amount is ৳50.00
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-gradient" id="proceedPaymentBtn">
          <span id="proceedPaymentText">Proceed to Payment</span>
          <span id="proceedPaymentSpinner" class="spinner-border spinner-border-sm" style="display: none;"></span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Withdraw Modal -->
<div class="modal fade" id="withdrawModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fa-solid fa-hand-holding-dollar me-2"></i>Withdraw Money</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="withdrawAmount" class="form-label">Amount (BDT)</label>
          <input type="number" class="form-control" id="withdrawAmount" placeholder="Enter amount">
          <div class="form-text text-danger" id="withdrawAmountError" style="display: none;"></div>
        </div>
        
        <div class="mb-3">
          <label for="withdrawMethod" class="form-label">Withdraw Method</label>
          <select class="form-select" id="withdrawMethod">
            <option value="" selected disabled>Select method</option>
            <option value="bkash">bKash</option>
            <option value="nagad">Nagad</option>
            <option value="rocket">Rocket</option>
            <option value="bank">Bank Account</option>
          </select>
          <div class="form-text text-danger" id="withdrawMethodError" style="display: none;"></div>
        </div>
        
        <div class="mb-3">
          <label for="accountNumber" class="form-label">Account Number</label>
          <input type="text" class="form-control" id="accountNumber" placeholder="Enter account number">
          <div class="form-text text-danger" id="accountNumberError" style="display: none;"></div>
        </div>
        
        <div class="alert alert-warning">
          <i class="fa-solid fa-circle-exclamation me-2"></i> Minimum withdrawal amount is ৳100.00
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-gradient" id="requestWithdrawalBtn">
          <span id="requestWithdrawalText">Request Withdrawal</span>
          <span id="requestWithdrawalSpinner" class="spinner-border spinner-border-sm" style="display: none;"></span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center py-5">
        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
          <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
          <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
        </svg>
        <h4 class="mb-2" id="successTitle">Order Successful!</h4>
        <p id="orderIdText" class="text-muted mb-3">Transaction ID: #...</p>
        <p class="mb-4" id="successMessage">Your diamonds will be added to your account within 30 minutes.</p>
        <button class="btn btn-gradient w-100" data-bs-dismiss="modal">
          <i class="fa-solid fa-check me-2"></i>Done
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS + Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>// Firebase configuration - Replace with your actual config
const firebaseConfig = {
  apiKey: "AIzaSyDuaWMh0eIJ2tdtLxYj43ij9MGSh_Yo22M",
  authDomain: "test-6977e.firebaseapp.com",
  projectId: "test-6977e",
  storageBucket: "test-6977e.appspot.com",
  messagingSenderId: "544329273038",
  appId: "1:544329273038:web:c7a31e12bec7c80741ca9f"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Enhanced diamond packages data
const packages = [
  { id: 1, diamonds: 25, price: 24 },
  { id: 2, diamonds: 50, price: 37 },
  { id: 3, diamonds: 115, price: 77 },
  { id: 4, diamonds: 240, price: 153 },
  { id: 5, diamonds: 355, price: 228 },
  { id: 6, diamonds: 480, price: 303 },
  { id: 7, diamonds: 505, price: 325 },
  { id: 8, diamonds: 610, price: 385 },
  { id: 9, diamonds: 850, price: 536 },
  { id: 10, diamonds: 1090, price: 687 },
  { id: 11, diamonds: 1240, price: 767 },
  { id: 12, diamonds: 2530, price: 1538 },
];

// Global variables
let selectedPackage = packages[0];
let paymentMethod = 'instant'; // 'wallet' or 'instant'
let currentPage = 'homePage';
let currentUser = null;
let walletBalance = 0;
let transactions = [];
let orders = [];

// DOM elements
const packagesContainer = document.getElementById('packagesContainer');
const selectedPriceText = document.getElementById('selectedPriceText');
const accountInput = document.getElementById('accountInput');
const accountError = document.getElementById('accountError');
const buyNowBtn = document.getElementById('buyNowBtn');
const walletPay = document.getElementById('walletPay');
const instantPay = document.getElementById('instantPay');
const userAvatar = document.getElementById('userAvatar');
const walletBalanceText = document.getElementById('walletBalanceText');
const walletBalanceBigText = document.getElementById('walletBalanceBigText');
const transactionsContainer = document.getElementById('transactionsContainer');
const allOrdersContainer = document.getElementById('allOrdersContainer');
const completedOrdersContainer = document.getElementById('completedOrdersContainer');
const pendingOrdersContainer = document.getElementById('pendingOrdersContainer');
const profileName = document.getElementById('profileName');
const memberSince = document.getElementById('memberSince');
const totalOrders = document.getElementById('totalOrders');
const totalSpent = document.getElementById('totalSpent');
const totalReferrals = document.getElementById('totalReferrals');
const profileAvatar = document.getElementById('profileAvatar');
const logoutBtn = document.getElementById('logoutBtn');
const logoutBtnBottom = document.getElementById('logoutBtnBottom');

// Initialize the application
function initializeApp() {
  renderPackages();
  setupEventListeners();
  setupNavigation();
  initFirebaseAuth();
}

// Initialize Firebase auth state listener
function initFirebaseAuth() {
  auth.onAuthStateChanged(user => {
    if (user) {
      // User is signed in
      currentUser = user;
      updateUserProfile();
      loadUserData();
      listenToWalletChanges();
      loadTransactions();
      loadOrders();
    } else {
      // User is signed out - redirect to login
      window.location.href = 'login.html';
    }
  });
}

// Update user profile in UI
function updateUserProfile() {
  if (!currentUser) return;
  
  // Set avatar
  const photoURL = currentUser.photoURL || `https://i.pravatar.cc/150?img=${Math.floor(Math.random() * 70)}`;
  userAvatar.src = photoURL;
  profileAvatar.src = photoURL;
  
  // Set name
  const displayName = currentUser.displayName || 'User';
  profileName.textContent = displayName;
  
  // Set member since date
  const joinDate = new Date(currentUser.metadata.creationTime);
  memberSince.textContent = `Member since ${joinDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}`;
}

// Load user data from Firestore
function loadUserData() {
  if (!currentUser) return;
  
  db.collection('users').doc(currentUser.uid).get()
    .then(doc => {
      if (doc.exists) {
        const userData = doc.data();
        
        // Update referral count if available
        if (userData.referrals) {
          totalReferrals.textContent = userData.referrals.length;
        }
      }
    })
    .catch(error => {
      console.error('Error loading user data:', error);
    });
}

// Listen to real-time wallet balance changes
function listenToWalletChanges() {
  if (!currentUser) return;
  
  db.collection('wallets').doc(currentUser.uid)
    .onSnapshot(doc => {
      if (doc.exists) {
        walletBalance = doc.data().balance || 0;
        updateWalletBalanceUI();
      } else {
        // Create wallet if it doesn't exist
        db.collection('wallets').doc(currentUser.uid).set({
          balance: 0,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      }
    });
}

// Update wallet balance in UI
function updateWalletBalanceUI() {
  walletBalanceText.textContent = `৳${walletBalance.toFixed(2)}`;
  walletBalanceBigText.textContent = `৳${walletBalance.toFixed(2)}`;
}

// Load transactions from Firestore
function loadTransactions(limit = 3) {
  if (!currentUser) return;
  
  showLoading(transactionsContainer);
  
  db.collection('transactions')
    .where('userId', '==', currentUser.uid)
    .orderBy('createdAt', 'desc')
    .limit(limit)
    .get()
    .then(querySnapshot => {
      transactions = [];
      transactionsContainer.innerHTML = '';
      
      if (querySnapshot.empty) {
        showEmptyState(transactionsContainer, 'No transactions yet', 'fa-wallet');
        return;
      }
      
      querySnapshot.forEach(doc => {
        const transaction = doc.data();
        transaction.id = doc.id;
        transactions.push(transaction);
        renderTransaction(transaction);
      });
    })
    .catch(error => {
      console.error('Error loading transactions:', error);
      showError(transactionsContainer, 'Failed to load transactions. Please try again.');
    });
}

// Render a single transaction
function renderTransaction(transaction) {
  const transactionEl = document.createElement('div');
  transactionEl.className = 'transaction-item';
  
  const isIncome = transaction.type === 'deposit' || transaction.type === 'refund';
  const iconClass = isIncome ? 'income' : 'expense';
  const amountClass = isIncome ? 'income' : 'expense';
  const amountPrefix = isIncome ? '+' : '-';
  const icon = isIncome ? 'fa-arrow-down' : 'fa-arrow-up';
  
  // Format date
  const date = transaction.createdAt?.toDate() || new Date();
  const formattedDate = date.toLocaleDateString('en-US', { 
    month: 'short', 
    day: 'numeric', 
    year: date.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined,
    hour: '2-digit',
    minute: '2-digit'
  });
  
  transactionEl.innerHTML = `
    <div class="transaction-icon ${iconClass}">
      <i class="fa-solid ${icon}"></i>
    </div>
    <div class="transaction-details">
      <div class="fw-500">${transaction.description || 'Transaction'}</div>
      <small class="text-muted">${formattedDate}</small>
    </div>
    <div class="transaction-amount ${amountClass}">${amountPrefix}৳${transaction.amount.toFixed(2)}</div>
  `;
  
  transactionsContainer.appendChild(transactionEl);
}

// Load orders from Firestore
function loadOrders(limit = 3) {
  if (!currentUser) return;
  
  showLoading(allOrdersContainer);
  showLoading(completedOrdersContainer);
  showLoading(pendingOrdersContainer);
  
  db.collection('orders')
    .where('userId', '==', currentUser.uid)
    .orderBy('createdAt', 'desc')
    .limit(limit)
    .get()
    .then(querySnapshot => {
      orders = [];
      allOrdersContainer.innerHTML = '';
      completedOrdersContainer.innerHTML = '';
      pendingOrdersContainer.innerHTML = '';
      
      if (querySnapshot.empty) {
        showEmptyState(allOrdersContainer, 'No orders yet', 'fa-gamepad');
        return;
      }
      
      querySnapshot.forEach(doc => {
        const order = doc.data();
        order.id = doc.id;
        orders.push(order);
        renderOrder(order);
      });
      
      // Update profile stats
      updateProfileStats();
    })
    .catch(error => {
      console.error('Error loading orders:', error);
      showError(allOrdersContainer, 'Failed to load orders. Please try again.');
    });
}

// Render a single order
function renderOrder(order) {
  const orderEl = document.createElement('div');
  orderEl.className = 'card order-card mb-3';
  
  // Determine status
  let statusClass = 'pending';
  let statusText = 'Pending';
  
  if (order.status === 'completed') {
    statusClass = 'completed';
    statusText = 'Completed';
  } else if (order.status === 'failed') {
    statusClass = 'failed';
    statusText = 'Failed';
  }
  
  // Format date
  const date = order.createdAt?.toDate() || new Date();
  const formattedDate = date.toLocaleDateString('en-US', { 
    month: 'short', 
    day: 'numeric', 
    year: date.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined,
    hour: '2-digit',
    minute: '2-digit'
  });
  
  orderEl.innerHTML = `
    <div class="card-body">
      <div class="d-flex justify-content-between mb-2">
        <div class="fw-500">${order.game || 'Game'} Topup</div>
        <span class="order-status ${statusClass}">${statusText}</span>
      </div>
      <div class="d-flex justify-content-between text-muted small mb-2">
        <div>Order #${order.id.substring(0, 8).toUpperCase()}</div>
        <div>${order.diamonds || 0} Diamonds</div>
      </div>
      <div class="d-flex justify-content-between">
        <small class="text-muted">${formattedDate}</small>
        <div class="fw-500 text-primary">৳${order.amount?.toFixed(2) || '0.00'}</div>
      </div>
    </div>
  `;
  
  // Append to appropriate containers
  allOrdersContainer.appendChild(orderEl.cloneNode(true));
  
  if (order.status === 'completed') {
    completedOrdersContainer.appendChild(orderEl.cloneNode(true));
  } else if (order.status === 'pending') {
    pendingOrdersContainer.appendChild(orderEl.cloneNode(true));
  }
}

// Update profile stats based on orders
function updateProfileStats() {
  if (!orders.length) return;
  
  // Calculate total orders
  totalOrders.textContent = orders.length;
  
  // Calculate total spent
  const spent = orders.reduce((sum, order) => sum + (order.amount || 0), 0);
  totalSpent.textContent = `৳${spent.toFixed(2)}`;
}

// Setup page navigation
function setupNavigation() {
  // Bottom nav links
  document.querySelectorAll('.bottom-nav a').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const pageId = this.getAttribute('data-page');
      
      // Update active state
      document.querySelectorAll('.bottom-nav a').forEach(el => el.classList.remove('active'));
      this.classList.add('active');
      
      // Show the selected page
      showPage(pageId);
    });
  });
  
  // Desktop nav links
  document.querySelectorAll('.desktop-nav .nav-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const pageId = this.getAttribute('data-page');
      
      // Update active state
      document.querySelectorAll('.desktop-nav .nav-link').forEach(el => el.classList.remove('active'));
      this.classList.add('active');
      
      // Show the selected page
      showPage(pageId);
    });
  });
  
  // Wallet balance click
  document.querySelector('.wallet-balance').addEventListener('click', function(e) {
    e.preventDefault();
    showPage('walletPage');
    
    // Update active state in desktop nav
    document.querySelectorAll('.desktop-nav .nav-link').forEach(el => el.classList.remove('active'));
    document.querySelector('.desktop-nav .nav-link[data-page="walletPage"]').classList.add('active');
  });
  
  // Logout buttons
  logoutBtn.addEventListener('click', handleLogout);
  logoutBtnBottom.addEventListener('click', handleLogout);
}

// Handle user logout
function handleLogout(e) {
  e.preventDefault();
  auth.signOut().then(() => {
    window.location.href = 'login.html';
  }).catch(error => {
    console.error('Logout error:', error);
    showToast('Failed to logout. Please try again.', 'danger');
  });
}

// Show specific page
function showPage(pageId) {
  if (pageId === currentPage) return;
  
  // Hide current page
  document.querySelector('.page.active').classList.remove('active');
  
  // Show new page
  document.getElementById(pageId).classList.add('active');
  currentPage = pageId;
  
  // Scroll to top
  window.scrollTo(0, 0);
  
  // Load data if needed
  if (pageId === 'walletPage') {
    loadTransactions();
  } else if (pageId === 'ordersPage') {
    loadOrders();
  }
}

// Render diamond packages in grid
function renderPackages() {
  packagesContainer.innerHTML = '';
  
  packages.forEach(pkg => {
    const div = document.createElement('div');
    div.className = `card-package fade-in ${pkg.popular ? 'popular' : ''}`;
    if (pkg.id === selectedPackage.id) div.classList.add('selected');
    div.dataset.id = pkg.id;
    
    div.innerHTML = `
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="d-flex align-items-center">
            <i class="fa-solid fa-gem diamond-icon"></i>
            <strong class="fs-5">${pkg.diamonds}</strong>
          </div>
          <small class="text-muted">Diamond</small>
        </div>
        <div class="text-end">
          <div class="price">৳${pkg.price}</div>
          ${pkg.popular ? '<small class="badge badge-primary">Popular</small>' : ''}
        </div>
      </div>
    `;
    
    div.addEventListener('click', () => {
      selectedPackage = pkg;
      updateSelectedUI();
    });
    
    packagesContainer.appendChild(div);
  });
  
  updateSelectedUI();
}

// Update UI when selection changes
function updateSelectedUI() {
  // Update package selection
  document.querySelectorAll('.card-package').forEach(el => {
    el.classList.toggle('selected', Number(el.dataset.id) === selectedPackage.id);
  });
  
  // Update price display
  selectedPriceText.textContent = `৳${selectedPackage.price}`;
  
  // Check if wallet balance is sufficient
  if (paymentMethod === 'wallet') {
    if (selectedPackage.price > walletBalance) {
      buyNowBtn.disabled = true;
      buyNowBtn.innerHTML = '<i class="fa-solid fa-lock me-2"></i>Insufficient Balance';
    } else {
      buyNowBtn.disabled = false;
      buyNowBtn.innerHTML = '<i class="fa-solid fa-bag-shopping me-2"></i>Buy Now';
    }
  }
}

// Validate account input
function validateAccount() {
  const val = accountInput.value.trim();
  if (!val) {
    accountError.style.display = 'block';
    accountInput.classList.add('is-invalid');
    accountInput.classList.add('shake');
    setTimeout(() => {
      accountInput.classList.remove('shake');
    }, 500);
    return false;
  }
  accountError.style.display = 'none';
  accountInput.classList.remove('is-invalid');
  return true;
}

// Show order confirmation modal
function openOrderModal() {
  if (!validateAccount()) {
    return;
  }
  
  const orderSummary = document.getElementById('orderSummary');
  orderSummary.innerHTML = `
    <div class="mb-3 p-3 bg-light rounded">
      <div class="d-flex justify-content-between mb-2">
        <span class="text-muted">Game:</span>
        <span class="fw-bold">Free Fire (BD)</span>
      </div>
      <div class="d-flex justify-content-between mb-2">
        <span class="text-muted">Player ID:</span>
        <span class="fw-bold">${escapeHtml(accountInput.value.trim())}</span>
      </div>
      <div class="d-flex justify-content-between mb-2">
        <span class="text-muted">Package:</span>
        <span class="fw-bold">${selectedPackage.diamonds} Diamonds</span>
      </div>
      <div class="d-flex justify-content-between mb-2">
        <span class="text-muted">Payment Method:</span>
        <span class="fw-bold">${paymentMethod === 'wallet' ? 'Wallet Balance' : 'bKash/Nagad/Rocket'}</span>
      </div>
      <hr>
      <div class="d-flex justify-content-between">
        <span class="text-muted">Total Amount:</span>
        <span class="fw-bold fs-5 text-primary">৳${selectedPackage.price}</span>
      </div>
    </div>
  `;
  
  const orderModal = new bootstrap.Modal(document.getElementById('orderModal'));
  orderModal.show();
}

// Place order
function placeOrder() {
  if (!currentUser) return;
  
  const note = document.getElementById('note').value.trim();
  const orderData = {
    userId: currentUser.uid,
    game: 'Free Fire',
    gameId: accountInput.value.trim(),
    diamonds: selectedPackage.diamonds,
    amount: selectedPackage.price,
    paymentMethod: paymentMethod,
    status: 'pending',
    note: note,
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  };
  
  // Show loading state
  const confirmBtn = document.getElementById('confirmOrderBtn');
  confirmBtn.disabled = true;
  confirmBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Processing...';
  
  // Add order to Firestore
  db.collection('orders').add(orderData)
    .then(docRef => {
      // If paid with wallet, deduct balance
      if (paymentMethod === 'wallet') {
        return db.collection('wallets').doc(currentUser.uid).update({
          balance: firebase.firestore.FieldValue.increment(-selectedPackage.price),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
          // Add transaction record
          return db.collection('transactions').add({
            userId: currentUser.uid,
            type: 'purchase',
            amount: selectedPackage.price,
            description: `Free Fire ${selectedPackage.diamonds} Diamonds`,
            orderId: docRef.id,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        });
      }
      return Promise.resolve();
    })
    .then(() => {
      // Show success
      const successModal = new bootstrap.Modal(document.getElementById('successModal'));
      document.getElementById('orderIdText').textContent = `Order ID: ${orderData.gameId.substring(0, 8).toUpperCase()}`;
      document.getElementById('successTitle').textContent = 'Order Successful!';
      document.getElementById('successMessage').textContent = 'Your diamonds will be added to your account within 30 minutes.';
      
      // Close order modal first
      bootstrap.Modal.getInstance(document.getElementById('orderModal'))?.hide();
      
      // Show success modal after a slight delay
      setTimeout(() => successModal.show(), 300);
      
      // Reset form
      accountInput.value = '';
      document.getElementById('note').value = '';
      
      // Reload orders
      loadOrders();
    })
    .catch(error => {
      console.error('Error placing order:', error);
      showToast('Failed to place order. Please try again.', 'danger');
    })
    .finally(() => {
      confirmBtn.disabled = false;
      confirmBtn.innerHTML = '<i class="fa-solid fa-lock me-2"></i>Confirm Payment';
    });
}

// Handle add money
function handleAddMoney() {
  const amountInput = document.getElementById('amount');
  const amount = parseFloat(amountInput.value);
  const amountError = document.getElementById('amountError');
  const selectedMethod = document.querySelector('#addMoneyModal .payment-option.selected').dataset.method;
  
  // Validate
  if (!amount || amount < 50) {
    amountError.textContent = amount < 50 ? 'Minimum amount is ৳50' : 'Please enter a valid amount';
    amountError.style.display = 'block';
    return;
  }
  
  amountError.style.display = 'none';
  
  // Show loading
  const proceedBtn = document.getElementById('proceedPaymentBtn');
  const proceedText = document.getElementById('proceedPaymentText');
  const proceedSpinner = document.getElementById('proceedPaymentSpinner');
  
  proceedText.textContent = 'Processing...';
  proceedSpinner.style.display = 'inline-block';
  proceedBtn.disabled = true;
  
  // In a real app, you would integrate with a payment gateway here
  // For demo purposes, we'll simulate a successful payment after 2 seconds
  
  setTimeout(() => {
    // Add to wallet
    db.collection('wallets').doc(currentUser.uid).update({
      balance: firebase.firestore.FieldValue.increment(amount),
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
      // Add transaction record
      return db.collection('transactions').add({
        userId: currentUser.uid,
        type: 'deposit',
        amount: amount,
        description: `Added via ${selectedMethod}`,
        paymentMethod: selectedMethod,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    }).then(() => {
      // Show success
      const successModal = new bootstrap.Modal(document.getElementById('successModal'));
      document.getElementById('orderIdText').textContent = `Transaction completed via ${selectedMethod}`;
      document.getElementById('successTitle').textContent = 'Payment Successful!';
      document.getElementById('successMessage').textContent = `৳${amount.toFixed(2)} has been added to your wallet.`;
      
      // Close add money modal
      bootstrap.Modal.getInstance(document.getElementById('addMoneyModal'))?.hide();
      
      // Show success modal
      successModal.show();
      
      // Reset form
      amountInput.value = '';
    }).catch(error => {
      console.error('Error adding money:', error);
      showToast('Failed to add money. Please try again.', 'danger');
    }).finally(() => {
      proceedText.textContent = 'Proceed to Payment';
      proceedSpinner.style.display = 'none';
      proceedBtn.disabled = false;
    });
  }, 2000);
}

// Handle withdrawal request
function handleWithdrawal() {
  const amountInput = document.getElementById('withdrawAmount');
  const methodSelect = document.getElementById('withdrawMethod');
  const accountInput = document.getElementById('accountNumber');
  
  const amount = parseFloat(amountInput.value);
  const method = methodSelect.value;
  const account = accountInput.value.trim();
  
  // Validate
  let isValid = true;
  
  if (!amount || amount < 100) {
    document.getElementById('withdrawAmountError').textContent = amount < 100 ? 'Minimum amount is ৳100' : 'Please enter a valid amount';
    document.getElementById('withdrawAmountError').style.display = 'block';
    isValid = false;
  } else {
    document.getElementById('withdrawAmountError').style.display = 'none';
  }
  
  if (!method) {
    document.getElementById('withdrawMethodError').textContent = 'Please select a method';
    document.getElementById('withdrawMethodError').style.display = 'block';
    isValid = false;
  } else {
    document.getElementById('withdrawMethodError').style.display = 'none';
  }
  
  if (!account) {
    document.getElementById('accountNumberError').textContent = 'Please enter account number';
    document.getElementById('accountNumberError').style.display = 'block';
    isValid = false;
  } else {
    document.getElementById('accountNumberError').style.display = 'none';
  }
  
  if (!isValid) return;
  
  // Check if balance is sufficient
  if (amount > walletBalance) {
    document.getElementById('withdrawAmountError').textContent = 'Insufficient balance';
    document.getElementById('withdrawAmountError').style.display = 'block';
    return;
  }
  
  // Show loading
  const requestBtn = document.getElementById('requestWithdrawalBtn');
  const requestText = document.getElementById('requestWithdrawalText');
  const requestSpinner = document.getElementById('requestWithdrawalSpinner');
  
  requestText.textContent = 'Processing...';
  requestSpinner.style.display = 'inline-block';
  requestBtn.disabled = true;
  
  // In a real app, you would process the withdrawal request
  // For demo purposes, we'll simulate processing
  
  setTimeout(() => {
    // Deduct from wallet
    db.collection('wallets').doc(currentUser.uid).update({
      balance: firebase.firestore.FieldValue.increment(-amount),
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
      // Add transaction record
      return db.collection('transactions').add({
        userId: currentUser.uid,
        type: 'withdrawal',
        amount: amount,
        description: `Withdrawal to ${method} (${account})`,
        status: 'pending',
        paymentMethod: method,
        accountNumber: account,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    }).then(() => {
      // Show success
      const successModal = new bootstrap.Modal(document.getElementById('successModal'));
      document.getElementById('orderIdText').textContent = `Withdrawal to ${method} (${account})`;
      document.getElementById('successTitle').textContent = 'Request Submitted!';
      document.getElementById('successMessage').textContent = `Your withdrawal request for ৳${amount.toFixed(2)} has been submitted. It will be processed within 24 hours.`;
      
      // Close withdrawal modal
      bootstrap.Modal.getInstance(document.getElementById('withdrawModal'))?.hide();
      
      // Show success modal
      successModal.show();
      
      // Reset form
      amountInput.value = '';
      methodSelect.value = '';
      accountInput.value = '';
    }).catch(error => {
      console.error('Error processing withdrawal:', error);
      showToast('Failed to process withdrawal. Please try again.', 'danger');
    }).finally(() => {
      requestText.textContent = 'Request Withdrawal';
      requestSpinner.style.display = 'none';
      requestBtn.disabled = false;
    });
  }, 2000);
}

// Setup all event listeners
function setupEventListeners() {
  // Buy Now buttons
  buyNowBtn.addEventListener('click', openOrderModal);
  
  // Payment method selection
  walletPay.addEventListener('click', () => {
    paymentMethod = 'wallet';
    walletPay.classList.add('selected');
    instantPay.classList.remove('selected');
    updateSelectedUI();
  });
  
  instantPay.addEventListener('click', () => {
    paymentMethod = 'instant';
    instantPay.classList.add('selected');
    walletPay.classList.remove('selected');
    updateSelectedUI();
  });
  
  // Account input validation
  accountInput.addEventListener('input', validateAccount);
  
  // Confirm order button
  document.getElementById('confirmOrderBtn').addEventListener('click', placeOrder);
  
  // Payment method selection in add money modal
  document.querySelectorAll('#addMoneyModal .payment-option').forEach(option => {
    option.addEventListener('click', function() {
      document.querySelectorAll('#addMoneyModal .payment-option').forEach(el => el.classList.remove('selected'));
      this.classList.add('selected');
    });
  });
  
  // Proceed to payment button
  document.getElementById('proceedPaymentBtn').addEventListener('click', handleAddMoney);
  
  // Request withdrawal button
  document.getElementById('requestWithdrawalBtn').addEventListener('click', handleWithdrawal);
  
  // View all transactions button
  document.getElementById('viewAllTransactionsBtn').addEventListener('click', function(e) {
    e.preventDefault();
    loadTransactions(20); // Load more transactions
  });
  
  // View all orders button
  document.getElementById('viewAllOrdersBtn').addEventListener('click', function(e) {
    e.preventDefault();
    loadOrders(20); // Load more orders
  });
  
  // Keyboard navigation for packages
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
      const idx = packages.findIndex(p => p.id === selectedPackage.id);
      selectedPackage = packages[Math.min(packages.length-1, idx+1)];
      updateSelectedUI();
    } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
      const idx = packages.findIndex(p => p.id === selectedPackage.id);
      selectedPackage = packages[Math.max(0, idx-1)];
      updateSelectedUI();
    }
  });
}

// Helper functions
function escapeHtml(text) {
  return text.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

function showLoading(container) {
  container.innerHTML = `
    <div class="text-center py-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>`;
}

function showEmptyState(container, title, icon = 'fa-info-circle') {
  container.innerHTML = `
    <div class="empty-state">
      <i class="fa-solid ${icon}"></i>
      <h5>${title}</h5>
      <p>Your history will appear here</p>
    </div>`;
}

function showError(container, message) {
  container.innerHTML = `
    <div class="alert alert-danger">
      <i class="fa-solid fa-circle-exclamation me-2"></i>
      ${message}
    </div>`;
}

function showToast(message, type = 'success') {
  const toast = document.createElement('div');
  toast.className = `toast show align-items-center text-white bg-${type} border-0`;
  toast.setAttribute('role', 'alert');
  toast.setAttribute('aria-live', 'assertive');
  toast.setAttribute('aria-atomic', 'true');
  
  toast.innerHTML = `
    <div class="d-flex">
      <div class="toast-body">${message}</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>`;
  
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', initializeApp);</script>
</body>
</html>